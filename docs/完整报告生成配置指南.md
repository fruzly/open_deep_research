# å®Œæ•´æŠ¥å‘Šç”Ÿæˆé…ç½®æŒ‡å—

**æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š** 2025-06-23  
**é€‚ç”¨ç‰ˆæœ¬ï¼š** Open Deep Research v1.0+  

## ğŸ“‹ æ¦‚è¿°

è¦ç”Ÿæˆå®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šï¼ˆè€Œä¸æ˜¯ç®€åŒ–çš„æµ‹è¯•è¾“å‡ºï¼‰ï¼Œéœ€è¦æ­£ç¡®é…ç½®æœç´¢åŠŸèƒ½å’Œå·¥ä½œæµå‚æ•°ã€‚å½“å‰çš„ `debug_messages.py` ä½¿ç”¨çš„æ˜¯ç®€åŒ–é…ç½®ï¼Œä¸ä¼šç”Ÿæˆå®Œæ•´æŠ¥å‘Šã€‚

## ğŸ”§ å…³é”®é…ç½®å·®å¼‚

### ç®€åŒ–é…ç½® vs å®Œæ•´é…ç½®

| é…ç½®é¡¹ | ç®€åŒ–é…ç½®ï¼ˆdebug_messages.pyï¼‰ | å®Œæ•´é…ç½® |
|--------|-------------------------------|----------|
| `search_api` | `"none"` | `"duckduckgo"` æˆ– `"tavily"` |
| `recursion_limit` | `3-20` | `30-50` |
| `number_of_queries` | `1` | `2-3` |
| æŠ¥å‘Šè¾“å‡º | æ—  `final_report` | å®Œæ•´çš„ `final_report` |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®¾ç½® API å¯†é’¥

```python
import os

# å¿…éœ€çš„ API å¯†é’¥
os.environ['GOOGLE_API_KEY'] = 'your_google_api_key_here'

# å¯é€‰ï¼šé«˜è´¨é‡æœç´¢ï¼ˆæ¨èï¼‰
os.environ['TAVILY_API_KEY'] = 'your_tavily_api_key_here'
```

### 2. åŸºç¡€å®Œæ•´æŠ¥å‘Šé…ç½®

```python
# å®Œæ•´æŠ¥å‘Šé…ç½®
config = {
    "thread_id": str(uuid.uuid4()),
    "search_api": "duckduckgo",  # ğŸ”‘ å¯ç”¨æœç´¢ï¼ˆå…è´¹ï¼‰
    "supervisor_model": "google_genai:gemini-2.5-flash-lite-preview-06-17",
    "researcher_model": "google_genai:gemini-2.5-flash-lite-preview-06-17",
    "number_of_queries": 2,     # ğŸ”‘ æ¯èŠ‚æœç´¢æŸ¥è¯¢æ•°
    "ask_for_clarification": False,  # ç›´æ¥ç”Ÿæˆï¼Œä¸è¯¢é—®
    "include_source_str": True, # åŒ…å«æºä¿¡æ¯
}

thread_config = {
    "configurable": config,
    "recursion_limit": 50       # ğŸ”‘ è¶³å¤Ÿçš„é€’å½’é™åˆ¶
}
```

### 3. è¿è¡Œå®Œæ•´æŠ¥å‘Šç”Ÿæˆ

```python
import asyncio
from src.open_deep_research.multi_agent import supervisor_builder
from langgraph.checkpoint.memory import MemorySaver

async def generate_full_report():
    # åˆ›å»º agent
    checkpointer = MemorySaver()
    agent = supervisor_builder.compile(name="full_report", checkpointer=checkpointer)
    
    # è¯¦ç»†çš„ç ”ç©¶æŸ¥è¯¢
    query = """
    Write a comprehensive report about [YOUR_TOPIC]. 
    Include multiple sections with detailed analysis, 
    current trends, and specific examples.
    """
    
    test_msg = [{"role": "user", "content": query}]
    
    # æ‰§è¡Œï¼ˆéœ€è¦ 2-5 åˆ†é’Ÿï¼‰
    response = await agent.ainvoke({"messages": test_msg}, config=thread_config)
    
    # è·å–å®Œæ•´æŠ¥å‘Š
    state = agent.get_state(thread_config)
    final_report = state.values.get('final_report', '')
    
    if final_report:
        print("âœ… å®Œæ•´æŠ¥å‘Šç”ŸæˆæˆåŠŸï¼")
        print(final_report)
        
        # ä¿å­˜åˆ°æ–‡ä»¶
        with open('generated_report.md', 'w', encoding='utf-8') as f:
            f.write(final_report)
    else:
        print("âŒ æŠ¥å‘Šç”Ÿæˆå¤±è´¥")

# è¿è¡Œ
asyncio.run(generate_full_report())
```

## ğŸ“Š é…ç½®é€‰é¡¹è¯¦è§£

### æœç´¢ API é€‰é¡¹

| API | ä¼˜åŠ¿ | åŠ£åŠ¿ | API å¯†é’¥éœ€æ±‚ |
|-----|------|------|-------------|
| `"tavily"` | é«˜è´¨é‡æœç´¢ï¼Œä¸“ä¸º AI ä¼˜åŒ– | ä»˜è´¹æœåŠ¡ | éœ€è¦ TAVILY_API_KEY |
| `"duckduckgo"` | å…è´¹ï¼Œæ˜“äºä½¿ç”¨ | æœç´¢è´¨é‡ä¸€èˆ¬ | æ— éœ€å¯†é’¥ |
| `"googlesearch"` | æœç´¢è´¨é‡å¥½ | éœ€è¦é…ç½® | éœ€è¦ç›¸å…³å¯†é’¥ |
| `"none"` | å¿«é€Ÿæµ‹è¯• | æ— æœç´¢ï¼ŒæŠ¥å‘Šè´¨é‡ä½ | æ— éœ€å¯†é’¥ |

### æ¨èé…ç½®é¢„è®¾

#### ğŸ¥‡ é«˜è´¨é‡é…ç½®ï¼ˆæ¨èï¼‰
```python
config = {
    "search_api": "tavily",
    "number_of_queries": 3,
    "recursion_limit": 50,
    "ask_for_clarification": False,
    "include_source_str": True,
}
```

#### ğŸ¥ˆ å¹³è¡¡é…ç½®ï¼ˆå…è´¹ï¼‰
```python
config = {
    "search_api": "duckduckgo",
    "number_of_queries": 2,
    "recursion_limit": 30,
    "ask_for_clarification": False,
    "include_source_str": True,
}
```

#### ğŸ¥‰ å¿«é€Ÿé…ç½®
```python
config = {
    "search_api": "duckduckgo",
    "number_of_queries": 1,
    "recursion_limit": 20,
    "ask_for_clarification": False,
    "include_source_str": False,
}
```

## ğŸ§ª æµ‹è¯•è„šæœ¬

ä½¿ç”¨ `test_full_report.py` å¿«é€Ÿæµ‹è¯•ï¼š

```bash
python test_full_report.py
```

è¯¥è„šæœ¬ä¼šï¼š
1. âœ… æ£€æŸ¥ API å¯†é’¥
2. ğŸ”§ ä½¿ç”¨å®Œæ•´é…ç½®
3. ğŸ“ ç”Ÿæˆç¤ºä¾‹æŠ¥å‘Š
4. ğŸ’¾ ä¿å­˜åˆ°æ–‡ä»¶
5. ğŸ“Š æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯

## ğŸ“ å®Œæ•´æŠ¥å‘Šç»“æ„

æˆåŠŸçš„å®Œæ•´æŠ¥å‘Šåº”åŒ…å«ï¼š

```markdown
# æŠ¥å‘Šæ ‡é¢˜

## å¼•è¨€/ä»‹ç»
- ä¸»é¢˜æ¦‚è¿°
- æŠ¥å‘ŠèŒƒå›´

## ä¸»ä½“ç« èŠ‚ 1
- è¯¦ç»†åˆ†æ
- å…·ä½“ä¾‹å­
- æ•°æ®æ”¯æŒ

## ä¸»ä½“ç« èŠ‚ 2
- è¿›ä¸€æ­¥æ¢è®¨
- å¯¹æ¯”åˆ†æ

## ç»“è®º
- å…³é”®å‘ç°æ€»ç»“
- æœªæ¥å±•æœ›
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆ `debug_messages.py` ä¸ç”Ÿæˆå®Œæ•´æŠ¥å‘Šï¼Ÿ
**A:** å› ä¸ºä½¿ç”¨äº† `"search_api": "none"` çš„ç®€åŒ–é…ç½®ï¼Œä»…ç”¨äºæµ‹è¯• Gemini å…¼å®¹æ€§ã€‚

### Q: æŠ¥å‘Šç”Ÿæˆéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
**A:** å®Œæ•´æŠ¥å‘Šé€šå¸¸éœ€è¦ 2-5 åˆ†é’Ÿï¼Œå–å†³äºï¼š
- æœç´¢ API å“åº”é€Ÿåº¦
- æŸ¥è¯¢æ•°é‡è®¾ç½®
- ç½‘ç»œè¿æ¥è´¨é‡

### Q: å¦‚ä½•æé«˜æŠ¥å‘Šè´¨é‡ï¼Ÿ
**A:** 
1. ä½¿ç”¨ Tavily APIï¼ˆé«˜è´¨é‡æœç´¢ï¼‰
2. å¢åŠ  `number_of_queries` 
3. æä¾›æ›´å…·ä½“çš„æŸ¥è¯¢
4. ç¡®ä¿é€’å½’é™åˆ¶å……è¶³

### Q: å‡ºç° KeyError: 'final_report' æ€ä¹ˆåŠï¼Ÿ
**A:** æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š
- [ ] `search_api` ä¸æ˜¯ `"none"`
- [ ] `recursion_limit` >= 30
- [ ] API å¯†é’¥æ­£ç¡®è®¾ç½®
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸

## ğŸ”„ ä»ç®€åŒ–é…ç½®è¿ç§»

å¦‚æœä½ ä¸€ç›´ä½¿ç”¨ `debug_messages.py`ï¼Œè¦ç”Ÿæˆå®Œæ•´æŠ¥å‘Šï¼š

```python
# ä¿®æ”¹ debug_messages.py ä¸­çš„é…ç½®
config = {
    "thread_id": str(uuid.uuid4()),
    "search_api": "duckduckgo",  # æ”¹ä¸º duckduckgo
    "supervisor_model": "google_genai:gemini-2.5-flash-lite-preview-06-17",
    "researcher_model": "google_genai:gemini-2.5-flash-lite-preview-06-17",
    "number_of_queries": 2,     # å¢åŠ æŸ¥è¯¢æ•°
}

thread_config = {
    "configurable": config, 
    "recursion_limit": 50       # å¢åŠ é€’å½’é™åˆ¶
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Gemini æ¶ˆæ¯åºåˆ—é—®é¢˜ä¿®å¤æ–‡æ¡£](./4_Geminiæ¶ˆæ¯åºåˆ—é—®é¢˜ä¿®å¤ä¸ä¼˜åŒ–_2025-06-23.md)
- [API å¯†é’¥é…ç½®æŒ‡å—](../README.md)
- [å¤šæ™ºèƒ½ä½“æ¶æ„è¯´æ˜](../multi_agent_langgraph.png)

---

**ç»´æŠ¤è€…ï¼š** AI Assistant  
**æœ€åæ›´æ–°ï¼š** 2025-06-23  
**çŠ¶æ€ï¼š** âœ… å·²éªŒè¯ 